<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ä¸‰æ æ¨ªå±åŸå‹ Â· ä¸–ç•Œ-å¯¹è¯-æ’è¯</title>
  <style>
    :root {
      --left-bg: rgba(40, 70, 90, 0.25);    /* å†·è‰² */
      --mid-bg: #1f1f23;                    /* ä¸­æ€§æ·±ç° */
      --right-bg: rgba(160, 90, 20, 0.18);  /* æš–è‰² */
      --card-bg: rgba(255,255,255,0.06);
      --text-primary: #eee;
      --text-secondary: #bfc7d5;
      --accent-warm: #ffb54a;
      --accent-cool: #6ec1c1;
      --danger: #ff5566;
      --ok: #4dc276;
      --shadow: 0 6px 16px rgba(0,0,0,0.25);
      --radius: 12px;
      --fast: 0.2s;
      --normal: 0.4s;
      --branch: 0.5s;
    }

    html, body {
      height: 100%;
      background: #0f1115;
      color: var(--text-primary);
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, "PingFang SC", "Microsoft YaHei", sans-serif;
    }

    /* ç«–å±ä¸æ”¯æŒæç¤º */
    #rotate-overlay {
      position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.8); z-index: 1000; font-size: 20px; text-align: center; padding: 24px;
    }

    /* å®¹å™¨ä¸ä¸‰æ å¸ƒå±€ */
    .app {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr; /* 25-50-25 */
      gap: 12px;
      height: 100%;
      padding: 12px 16px;
      box-sizing: border-box;
    }

    .panel {
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex; flex-direction: column;
      min-height: 0; /* å…è®¸å†…éƒ¨æ»šåŠ¨ */
    }

    /* å·¦æ  */
    #world-panel { background: linear-gradient(180deg, var(--left-bg), transparent 65%), radial-gradient(1200px 600px at 0% 0%, rgba(80,120,140,0.25), transparent 60%); }
    #world-events { padding: 12px; overflow: auto; }
    .event-card {
      background: var(--card-bg);
      border: 1px solid rgba(160,200,220,0.18);
      border-radius: 10px; padding: 10px 12px; margin-bottom: 10px;
      animation: slideIn var(--normal) ease;
    }
    .event-card.new { box-shadow: 0 0 0 2px rgba(160,200,220,0.45) inset; animation: flash var(--fast) ease-in; }
    .event-time { font-size: 12px; color: var(--text-secondary); }
    .event-title { font-weight: 700; margin: 6px 0 4px; }
    .event-desc { font-size: 14px; color: #d9e2ef; opacity: 0.9; }

    /* ä¸­æ  */
    #chat-panel { background: var(--mid-bg); position: relative; }
    #chat-stream { padding: 12px; overflow: auto; display: flex; flex-direction: column; gap: 10px; }
    .msg { max-width: 76%; padding: 10px 12px; background: #2a2d33; border-radius: 12px; line-height: 1.4; }
    .msg.npc { align-self: flex-start; border-bottom-left-radius: 4px; }
    .msg.player { align-self: flex-end; background: #3b3f47; border-bottom-right-radius: 4px; }
    .msg.branch { outline: 2px dashed rgba(255,181,74,0.5); animation: branch var(--branch) ease; }

    #composer { display: grid; grid-template-columns: 1fr auto auto; gap: 8px; padding: 10px; background: rgba(255,255,255,0.03); border-top: 1px solid rgba(255,255,255,0.06); }
    #input-text { background: #24272e; color: var(--text-primary); border: 1px solid #3a3f48; border-radius: 8px; padding: 10px; }
    #btn-send, #btn-voice-mini {
      background: #3a3f48; color: #fff; border: 0; border-radius: 8px; padding: 10px 12px; cursor: pointer;
    }

    #btn-eagle, #btn-mosquito {
      position: absolute; bottom: 72px; width: 44px; height: 44px; border-radius: 50%; border: 0; cursor: pointer;
      display: grid; place-items: center; box-shadow: var(--shadow);
    }
    #btn-eagle { left: 12px; background: radial-gradient(circle at 30% 30%, #6ec1c1, #244b50); }
    #btn-mosquito { right: 12px; background: radial-gradient(circle at 70% 30%, #ffb54a, #7a3f18); }

    #chat-pause-overlay { position: absolute; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.55); z-index: 5; }
    #chat-pause-overlay .wave { width: 72px; height: 16px; background: repeating-linear-gradient(90deg, #fff 0 12px, transparent 12px 16px); opacity: 0.75; animation: pulse 1s infinite ease-in-out; border-radius: 8px; }

    /* å³æ  */
    #interject-panel { background: linear-gradient(180deg, var(--right-bg), transparent 65%); }
    #interject-scroll { padding: 12px; overflow: auto; display: flex; flex-direction: column; gap: 10px; }
    .interject-suggest { text-align: left; background: #3c2f24; color: #ffd59a; border: 1px solid #8a5a2d; border-radius: 10px; padding: 10px 12px; cursor: pointer; }
    .interject-suggest:hover { filter: brightness(1.05); }

    #voice-area { margin-top: auto; padding: 12px; border-top: 1px solid rgba(255,255,255,0.06); }
    #btn-voice { width: 100%; padding: 14px 12px; border-radius: 12px; border: 2px dashed #cc8844; background: rgba(255,181,74,0.15); color: #ffd59a; cursor: pointer; }
    #btn-voice.recording { border-style: solid; background: rgba(255,85,102,0.15); border-color: var(--danger); }
    #hint { color: #ffd59a; opacity: 0.8; font-size: 12px; margin-top: 6px; }

    /* æŠ½å±‰è§¦å‘ï¼ˆæ‰‹æœºæ¨ªå±æ—¶æ˜¾ç¤ºï¼‰ */
    .drawer-toggle { display: none; position: fixed; top: 12px; width: 40px; height: 40px; border-radius: 20px; border: 0; cursor: pointer; z-index: 20; box-shadow: var(--shadow); }
    #toggle-left { left: 12px; background: #25404a; color: #9fd7d7; }
    #toggle-right { right: 12px; background: #6b3a1a; color: #ffd59a; }

    .drawer { position: fixed; top: 0; bottom: 0; width: min(86vw, 360px); background: #111; box-shadow: var(--shadow); transform: translateX(-110%); transition: transform var(--normal); z-index: 15; display: flex; flex-direction: column; }
    .drawer.right { right: 0; left: auto; transform: translateX(110%); }
    .drawer.open.left { transform: translateX(0); }
    .drawer.open.right { transform: translateX(0); }

    /* åŠ¨ç”» */
    @keyframes slideIn { from { transform: translateY(8px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes flash { 0% { box-shadow: 0 0 0 0 rgba(160,200,220,0.8) inset; } 100% { box-shadow: 0 0 0 2px rgba(160,200,220,0.45) inset; } }
    @keyframes pulse { 0% { opacity: 0.4; } 50% { opacity: 1; } 100% { opacity: 0.4; } }
    @keyframes branch { 0% { transform: scale(1.0); } 35% { transform: scale(1.03); } 100% { transform: scale(1.0); } }

    /* æ–­ç‚¹ä¸é€‚é… */
    @media (max-width: 900px) {
      .app { grid-template-columns: 1fr; }
      #world-panel, #interject-panel { display: none; }
      #toggle-left, #toggle-right { display: block; }
      .drawer { display: flex; }
    }

    /* å­—ä½“æ”¾å¤§ï¼ˆå¹³æ¿è¿‘ä¼¼ï¼‰ */
    @media (min-width: 900px) and (max-width: 1200px) {
      body { font-size: 17px; }
    }

    /* è½»è¾¹è·ï¼ˆå¤§å±ï¼‰ */
    @media (min-width: 1400px) {
      .app { padding: 16px 32px; gap: 16px; }
    }
  </style>
</head>
<body>
  <div id="rotate-overlay">æœ¬åŸå‹ä¸æ”¯æŒç«–å±ï¼Œè¯·æ—‹è½¬è®¾å¤‡è‡³æ¨ªå±ä»¥ç»§ç»­ä½“éªŒã€‚</div>

  <!-- æ‰‹æœºæ¨ªå±æŠ½å±‰å¼€å…³ -->
  <button id="toggle-left" class="drawer-toggle" aria-label="æ‰“å¼€ä¸–ç•Œäº‹ä»¶">â˜°</button>
  <button id="toggle-right" class="drawer-toggle" aria-label="æ‰“å¼€æ’è¯åŒº">âœ¦</button>

  <!-- æŠ½å±‰ï¼ˆä¸å·¦/å³æ å†…å®¹å¤ç”¨ç»“æ„ï¼‰ -->
  <aside id="drawer-left" class="drawer left" aria-hidden="true">
    <header style="padding:12px 12px 0; color:#9fd7d7">ä¸–ç•Œå…³é”®äº‹ä»¶</header>
    <div id="drawer-world" style="padding:12px; overflow:auto"></div>
  </aside>
  <aside id="drawer-right" class="drawer right" aria-hidden="true">
    <header style="padding:12px 12px 0; color:#ffd59a">æ’è¯å»ºè®® & è¯­éŸ³</header>
    <div id="drawer-interject" style="padding:12px; overflow:auto"></div>
  </aside>

  <main class="app" role="application">
    <!-- å·¦æ ï¼šä¸–ç•Œå…³é”®äº‹ä»¶ -->
    <section id="world-panel" class="panel" aria-label="ä¸–ç•Œå…³é”®äº‹ä»¶">
      <div id="world-events"></div>
    </section>

    <!-- ä¸­æ ï¼šç©å®¶å¯¹è¯ä¸»åœº -->
    <section id="chat-panel" class="panel" aria-label="ç©å®¶å¯¹è¯">
      <div id="chat-pause-overlay"><div class="wave" title="è¯­éŸ³å¤„ç†ä¸­â€¦"></div></div>
      <div id="chat-stream"></div>
      <div id="composer">
        <input id="input-text" placeholder="è¾“å…¥ä»¥è·Ÿéšå‘½è¿â€¦ï¼ˆæˆ–å³ä¾§é€‰æ‹©æ’è¯ï¼‰" />
        <button id="btn-voice-mini" title="çŸ­æŒ‰å½•éŸ³">è¯­éŸ³</button>
        <button id="btn-send">å‘é€</button>
      </div>
      <button id="btn-eagle" title="ä¿¯ç°ä¸–ç•Œå±€åŠ¿" aria-label="è€é¹°">ğŸ¦…</button>
      <button id="btn-mosquito" title="å¾®å°æ‰°åŠ¨Â·è¿›åŒ–" aria-label="èšŠå­">ğŸ¦Ÿ</button>
    </section>

    <!-- å³æ ï¼šæ’è¯åŒº -->
    <aside id="interject-panel" class="panel" aria-label="æ’è¯åŒº">
      <div id="interject-scroll"></div>
      <div id="voice-area">
        <button id="btn-voice">é•¿æŒ‰è¯´è¯ä»¥æš‚åœç¾¤èŠ</button>
        <div id="hint">æç¤ºï¼šé•¿æŒ‰æœŸé—´ä¸­æ ä¼šæš‚åœï¼Œè¯†åˆ«ç»“æŸåå¯¹ä¸–ç•Œäº§ç”Ÿç»†å¾®å˜åŒ–</div>
      </div>
    </aside>
  </main>

  <script>
    // ç«–å±é®ç½©
    function updateOrientationOverlay() {
      const overlay = document.getElementById('rotate-overlay');
      const isPortrait = window.matchMedia('(orientation: portrait)').matches;
      overlay.style.display = isPortrait ? 'flex' : 'none';
    }
    window.addEventListener('resize', updateOrientationOverlay);
    updateOrientationOverlay();

    // åˆå§‹åŒ–ç¤ºä¾‹æ•°æ®
    const worldEventsRoot = document.getElementById('world-events');
    const chatStream = document.getElementById('chat-stream');
    const interjectRoot = document.getElementById('interject-scroll');

    const sampleEvents = [
      { t: 'ç¬¬ 1 æ—¥Â·æ™¨', title: 'é£æš´è¿œå¤„é…é…¿', desc: 'æ¸”æ°‘æŠ¥å‘Šå¤–æµ·æ°”å‹å¼‚å¸¸ï¼Œæµ·é¸Ÿèšé›†æˆç¾¤ã€‚' },
      { t: 'ç¬¬ 1 æ—¥Â·åˆ', title: 'è¾¹å¢ƒçƒ½çƒŸ', desc: 'å·¡é€»é˜Ÿå‘ç°æœªçŸ¥æ——å¸œçš„æ–¥å€™ï¼Œç–‘ä¼¼è¯•æ¢ã€‚' },
      { t: 'ç¬¬ 1 æ—¥Â·æ˜', title: 'å¸‚é›†ä¸­è¯¡å¼‚ä½é¸£', desc: 'æœ‰äººå£°ç§°å¬è§æŒç»­çš„å—¡å—¡å£°ã€‚' },
    ];

    const aiSuggestionsBase = [
      'ä¹Ÿè®¸æˆ‘ä»¬ä½ä¼°äº†å¤©ç©ºçš„å½±å­â€¦',
      'ç­‰ç­‰ï¼Œå…ˆåˆ«è¯´è¯ï¼Œå¬â€”â€”ä½ å¬è§äº†å—ï¼Ÿ',
      'å‘ä¸œè½¬ç§»é˜Ÿä¼ï¼Œèº²å¼€é£æš´çœ¼ã€‚',
      'æŠŠæ¶ˆæ¯å‹ä¸‹å»ï¼Œå…å¾—å¼•èµ·ææ…Œã€‚',
    ];

    function renderEvents(target) {
      target.innerHTML = '';
      for (const ev of sampleEvents) {
        const card = document.createElement('div');
        card.className = 'event-card';
        card.innerHTML = `
          <div class="event-time">${ev.t}</div>
          <div class="event-title">${ev.title}</div>
          <div class="event-desc">${ev.desc}</div>
        `;
        target.appendChild(card);
      }
    }

    function pushChat(text, role = 'npc', isBranch = false) {
      const m = document.createElement('div');
      m.className = `msg ${role}` + (isBranch ? ' branch' : '');
      m.textContent = text;
      chatStream.appendChild(m);
      chatStream.scrollTop = chatStream.scrollHeight;
    }

    function renderAISuggestions(target) {
      target.innerHTML = '';
      aiSuggestionsBase.forEach((line) => {
        const b = document.createElement('button');
        b.className = 'interject-suggest';
        b.textContent = line;
        b.addEventListener('click', () => {
          // æ’è¯æˆåŠŸ â†’ ä¸­æ çŸ­åˆ†æ”¯åŠ¨ç”»ï¼Œç„¶åå›åˆ°ä¸»çº¿
          pushChat(line, 'player', true);
          setTimeout(() => {
            pushChat('â€¦â€¦å‘½è¿çš„é½¿è½®ç»§ç»­è½¬åŠ¨ã€‚', 'npc', false);
          }, 650);
        });
        target.appendChild(b);
      });
    }

    renderEvents(worldEventsRoot);
    renderAISuggestions(interjectRoot);

    // åŒæ­¥åˆ°æŠ½å±‰ï¼ˆç§»åŠ¨æ¨ªå±ï¼‰
    const drawerWorld = document.getElementById('drawer-world');
    const drawerInterject = document.getElementById('drawer-interject');
    function syncDrawers() {
      drawerWorld.innerHTML = worldEventsRoot.innerHTML;
      drawerInterject.innerHTML = interjectRoot.innerHTML + document.getElementById('voice-area').outerHTML;
    }
    syncDrawers();

    // åˆå§‹å¯¹è¯
    pushChat('ã€ç³»ç»Ÿã€‘ä¸–ç•Œå°½æ”¶çœ¼åº•ã€‚');
    pushChat('ä½ è¿Ÿåˆ°äº†ã€‚é£æš´ä¸ä¼šç­‰äººã€‚', 'npc');

    // å‘é€æ–‡æœ¬
    const input = document.getElementById('input-text');
    document.getElementById('btn-send').addEventListener('click', () => {
      const v = input.value.trim();
      if (!v) return;
      pushChat(v, 'player');
      input.value = '';
    });

    // è¯­éŸ³ï¼ˆå³ä¸‹æŒ‰é’®Â·é•¿æŒ‰ï¼‰
    const btnVoice = document.getElementById('btn-voice');
    const pauseOverlay = document.getElementById('chat-pause-overlay');
    let pressTimer = null;
    function startRecording() {
      btnVoice.classList.add('recording');
      pauseOverlay.style.display = 'flex';
    }
    function stopRecording() {
      btnVoice.classList.remove('recording');
      pauseOverlay.style.display = 'none';
      // è¯­éŸ³è¯†åˆ«å ä½ â†’ å½±å“ä¸–ç•Œå¾®å°å˜åŒ–
      pushChat('ï¼ˆä½ çš„ä½è¯­åœ¨é£ä¸­æ‰©æ•£â€¦â€¦ï¼‰', 'player', true);
      // ä¸ºæ¨¡æ‹Ÿï¼šå‘å·¦æ è¿½åŠ â€œæ–°äº‹ä»¶â€å¹¶é—ªçƒ
      const ev = { t: 'ç¬¬ 1 æ—¥Â·å¤œ', title: 'è¯¡å“å›è¡', desc: 'æ®è¯´å—¡é¸£æ±‡æˆå›å£°å¢™ï¼ŒçŸ­æš‚åœæ»äº†äº‰åµã€‚' };
      sampleEvents.unshift(ev);
      const card = document.createElement('div');
      card.className = 'event-card new';
      card.innerHTML = `<div class="event-time">${ev.t}</div><div class="event-title">${ev.title}</div><div class="event-desc">${ev.desc}</div>`;
      worldEventsRoot.prepend(card);
      syncDrawers();
    }
    btnVoice.addEventListener('mousedown', startRecording);
    btnVoice.addEventListener('touchstart', (e) => { e.preventDefault(); startRecording(); });
    ['mouseup','mouseleave','touchend','touchcancel'].forEach(evt => btnVoice.addEventListener(evt, stopRecording));

    // ä¸­æ å°è¯­éŸ³æŒ‰é’®ï¼ˆçŸ­æŒ‰ç¤ºä¾‹ï¼‰
    document.getElementById('btn-voice-mini').addEventListener('click', () => {
      pushChat('ï¼ˆçŸ­è¯­éŸ³ï¼‰å…ˆæš‚åœä¸€ä¸‹ã€‚', 'player', true);
    });

    // è€é¹°æŒ‰é’®ï¼ˆå®è§‚è§†è§’å ä½ï¼‰
    document.getElementById('btn-eagle').addEventListener('click', () => {
      alert('è€é¹°ï¼šä¿¯ç°ä¸–ç•Œå±€åŠ¿\n\nåŠ¿åŠ›èŒƒå›´ï¼šåŒ—å¢ƒâ†‘ï¼Œè¾¹å¢ƒç´§å¼ åº¦ï¼šä¸­â†’é«˜\nï¼ˆåç§»ç´¯è®¡åï¼Œå°†å‡ºç°è¡€è‰²ç³å­”é—ªçƒè­¦å‘Šï¼‰');
    });

    // èšŠå­æŒ‰é’®ï¼ˆè¿›åŒ–é¢æ¿å ä½ï¼‰
    document.getElementById('btn-mosquito').addEventListener('click', () => {
      alert('èšŠå­è¿›åŒ–ï¼š\n- æ¯’æ€§ / é€Ÿåº¦ / éšåŒ¿ / ç¾¤èš\nè¿›åŒ–å°†å¢å¼ºå³æ æ’è¯å½±å“åŠ›ï¼Œå¹¶æ”¹å˜å›æ”¶è‡³ä¸»çº¿çš„éš¾åº¦ã€‚');
    });

    // æ‰‹æœºæ¨ªå±ï¼šæŠ½å±‰å¼€å…³
    const drawerLeft = document.getElementById('drawer-left');
    const drawerRight = document.getElementById('drawer-right');
    document.getElementById('toggle-left').addEventListener('click', () => {
      drawerLeft.classList.toggle('open'); drawerLeft.classList.toggle('left');
      drawerLeft.setAttribute('aria-hidden', String(!drawerLeft.classList.contains('open')));
    });
    document.getElementById('toggle-right').addEventListener('click', () => {
      drawerRight.classList.toggle('open'); drawerRight.classList.toggle('right');
      drawerRight.setAttribute('aria-hidden', String(!drawerRight.classList.contains('open')));
    });
  </script>
</body>
</html>